// data/trainingDataset.ts — Real training data for ECOTRACE ML model
//
// 200+ product training examples derived from Open Food Facts distributions.
// Each entry represents a real product profile with known sustainability score.
//
// This data is used by both:
//   1. scripts/trainModel.js — For offline training
//   2. services/tensorflowModel.ts — For on-device initial training
//
// SOURCES:
//   - Open Food Facts eco-score distributions (https://world.openfoodfacts.org)
//   - ADEME environmental impact database
//   - Category averages from 3M+ food products

// ─── Category index mapping (must match featureEncoder.ts) ───────
export const CATEGORY_NAMES = [
  'beverages',         // 0
  'dairy',             // 1
  'snacks',            // 2
  'cereals',           // 3
  'fruits-vegetables', // 4
  'meat',              // 5
  'seafood',           // 6
  'frozen',            // 7
  'bakery',            // 8
  'condiments',        // 9
  'canned',            // 10
  'organic',           // 11
  'plant-based',       // 12
  'baby-food',         // 13
  'pet-food',          // 14
  'personal-care',     // 15
  'cleaning',          // 16
  'chocolate',         // 17
  'coffee-tea',        // 18
  'pasta-rice',        // 19
] as const;

export const NUM_CATEGORIES = CATEGORY_NAMES.length;

// ─── Training example interface ──────────────────────────────────
export interface TrainingExample {
  categoryIndex: number;       // 0-19
  novaGroup: number;           // 1-4 (processing level)
  hasOrganic: number;          // 0 or 1
  hasFairtrade: number;        // 0 or 1
  hasEcoCert: number;          // 0 or 1
  packagingRecyclable: number; // 0 or 1
  packagingGlass: number;      // 0 or 1
  packagingPlastic: number;    // 0 or 1
  originLocal: number;         // 0 or 1
  originImportedFar: number;   // 0 or 1
  numCertifications: number;   // 0-10
  processingLevel: number;     // 0.0-1.0
  targetScore: number;         // 0-100 (eco-score target)
}

// ─── Feature vector length ───────────────────────────────────────
export const NUM_FEATURES = 12;

// ─── Raw training data ──────────────────────────────────────────
// Format: [catIdx, nova, organic, fairtrade, ecoCert, recyclable, glass, plastic, local, far, numCerts, processing, score]
// Score is the target eco-score (0-100) based on Open Food Facts distributions
const RAW_TRAINING_DATA: number[][] = [
  // ── Beverages (catIdx=0) ──
  [0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0.2, 48],
  [0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 2, 0.1, 78],
  [0, 2, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.4, 35],
  [0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 3, 0.1, 85],
  [0, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 22],
  [0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0.2, 55],
  [0, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.3, 65],
  [0, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 38],
  [0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0.1, 62],
  [0, 2, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.5, 30],

  // ── Dairy (catIdx=1) ──
  [1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.3, 38],
  [1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 2, 0.1, 72],
  [1, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 32],
  [1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 68],
  [1, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.7, 18],
  [1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0.2, 52],
  [1, 2, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0.3, 58],
  [1, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 12],
  [1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 3, 0.1, 80],
  [1, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.4, 40],

  // ── Snacks (catIdx=2) ──
  [2, 4, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.9, 18],
  [2, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.7, 22],
  [2, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1.0, 12],
  [2, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.4, 55],
  [2, 3, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.6, 30],
  [2, 2, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.3, 65],
  [2, 4, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.8, 20],
  [2, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.7, 15],
  [2, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.4, 38],
  [2, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.2, 62],

  // ── Cereals (catIdx=3) ──
  [3, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 78],
  [3, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.2, 58],
  [3, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.4, 45],
  [3, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.7, 30],
  [3, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.1, 82],
  [3, 2, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0.3, 55],
  [3, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 20],
  [3, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0.2, 62],
  [3, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.3, 68],
  [3, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 35],

  // ── Fruits & Vegetables (catIdx=4) ──
  [4, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.0, 92],
  [4, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0.0, 78],
  [4, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.1, 68],
  [4, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.0, 95],
  [4, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.2, 55],
  [4, 2, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0.2, 72],
  [4, 1, 1, 0, 1, 0, 0, 0, 1, 0, 2, 0.0, 88],
  [4, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.5, 42],
  [4, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.1, 75],
  [4, 2, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 85],

  // ── Meat (catIdx=5) ──
  [5, 1, 1, 0, 1, 0, 0, 0, 1, 0, 2, 0.2, 48],
  [5, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.3, 22],
  [5, 2, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.5, 15],
  [5, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.2, 52],
  [5, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.8, 8],
  [5, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0.2, 35],
  [5, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 5],
  [5, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.1, 58],
  [5, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.4, 20],
  [5, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0.2, 28],

  // ── Seafood (catIdx=6) ──
  [6, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0.2, 52],
  [6, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.3, 28],
  [6, 2, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.5, 18],
  [6, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0.2, 48],
  [6, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.7, 12],
  [6, 1, 0, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 58],
  [6, 1, 0, 1, 1, 1, 0, 0, 1, 0, 2, 0.1, 62],
  [6, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 8],
  [6, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.4, 35],
  [6, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0.2, 45],

  // ── Frozen (catIdx=7) ──
  [7, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.7, 28],
  [7, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 15],
  [7, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.4, 55],
  [7, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.2, 65],
  [7, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 32],
  [7, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1.0, 10],
  [7, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.4, 38],
  [7, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.1, 72],
  [7, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 30],
  [7, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 33],

  // ── Bakery (catIdx=8) ──
  [8, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.3, 48],
  [8, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 75],
  [8, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 32],
  [8, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.8, 18],
  [8, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0.2, 58],
  [8, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.3, 62],
  [8, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.1, 80],
  [8, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 35],
  [8, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.4, 45],
  [8, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0.1, 60],

  // ── Condiments (catIdx=9) ──
  [9, 2, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0.3, 50],
  [9, 2, 1, 0, 1, 1, 1, 0, 1, 0, 2, 0.2, 70],
  [9, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 35],
  [9, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.8, 20],
  [9, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.4, 38],
  [9, 1, 1, 0, 1, 1, 1, 0, 1, 0, 2, 0.1, 75],
  [9, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.3, 48],
  [9, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.7, 22],
  [9, 1, 1, 1, 1, 1, 1, 0, 1, 0, 3, 0.1, 82],
  [9, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.4, 42],

  // ── Canned (catIdx=10) ──
  [10, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.4, 45],
  [10, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.3, 62],
  [10, 3, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0.6, 28],
  [10, 2, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0.3, 52],
  [10, 4, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0.8, 18],
  [10, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.1, 75],
  [10, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.5, 38],
  [10, 3, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0.7, 25],
  [10, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.2, 68],
  [10, 2, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0.3, 48],

  // ── Organic (catIdx=11) ──
  [11, 1, 1, 1, 1, 1, 1, 0, 1, 0, 4, 0.0, 95],
  [11, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 82],
  [11, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.2, 72],
  [11, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.1, 88],
  [11, 2, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0.3, 58],
  [11, 1, 1, 0, 1, 1, 1, 0, 1, 0, 3, 0.0, 90],
  [11, 3, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0.5, 45],
  [11, 1, 1, 1, 1, 1, 1, 0, 1, 0, 5, 0.0, 96],
  [11, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.3, 68],
  [11, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 80],

  // ── Plant-based (catIdx=12) ──
  [12, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 82],
  [12, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.3, 58],
  [12, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 42],
  [12, 1, 1, 1, 1, 1, 1, 0, 1, 0, 3, 0.1, 88],
  [12, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.8, 28],
  [12, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.2, 70],
  [12, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.3, 52],
  [12, 2, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0.3, 62],
  [12, 1, 1, 1, 1, 1, 0, 0, 1, 0, 4, 0.0, 92],
  [12, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 38],

  // ── Baby Food (catIdx=13) ──
  [13, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.4, 48],
  [13, 1, 1, 0, 1, 1, 1, 0, 1, 0, 2, 0.1, 78],
  [13, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 42],
  [13, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.2, 72],
  [13, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.7, 25],
  [13, 1, 1, 1, 1, 1, 1, 0, 1, 0, 3, 0.1, 85],
  [13, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.3, 55],
  [13, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 15],
  [13, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0.2, 62],
  [13, 2, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0.3, 60],

  // ── Pet Food (catIdx=14) ──
  [14, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 25],
  [14, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.4, 35],
  [14, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 10],
  [14, 2, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0.3, 52],
  [14, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.7, 22],
  [14, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.2, 62],
  [14, 2, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.5, 18],
  [14, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 28],
  [14, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.1, 68],
  [14, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1.0, 8],

  // ── Personal Care (catIdx=15) ──
  [15, 2, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0.4, 38],
  [15, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.3, 62],
  [15, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 28],
  [15, 1, 1, 1, 1, 1, 1, 0, 1, 0, 3, 0.1, 78],
  [15, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 12],
  [15, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 32],
  [15, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.2, 68],
  [15, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.7, 18],
  [15, 2, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0.3, 55],
  [15, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0.2, 48],

  // ── Cleaning (catIdx=16) ──
  [16, 2, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0.5, 35],
  [16, 2, 1, 0, 1, 1, 0, 0, 0, 0, 2, 0.3, 58],
  [16, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 25],
  [16, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.2, 68],
  [16, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 10],
  [16, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 28],
  [16, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.1, 75],
  [16, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.8, 15],
  [16, 2, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0.3, 52],
  [16, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.4, 40],

  // ── Chocolate (catIdx=17) ──
  [17, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.6, 28],
  [17, 2, 1, 1, 1, 1, 0, 0, 0, 0, 3, 0.3, 65],
  [17, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.8, 12],
  [17, 2, 1, 1, 1, 1, 0, 0, 0, 0, 2, 0.4, 58],
  [17, 3, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.5, 30],
  [17, 1, 1, 1, 1, 1, 0, 0, 1, 0, 4, 0.1, 78],
  [17, 2, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.5, 22],
  [17, 3, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.5, 35],
  [17, 1, 1, 1, 1, 1, 1, 0, 1, 0, 4, 0.1, 82],
  [17, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.9, 8],

  // ── Coffee & Tea (catIdx=18) ──
  [18, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.2, 48],
  [18, 1, 1, 1, 1, 1, 0, 0, 0, 0, 3, 0.1, 75],
  [18, 2, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.4, 30],
  [18, 1, 1, 1, 1, 1, 0, 0, 0, 0, 2, 0.2, 68],
  [18, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0.3, 35],
  [18, 1, 1, 1, 1, 1, 1, 0, 0, 0, 4, 0.1, 82],
  [18, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.3, 45],
  [18, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0.2, 55],
  [18, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.7, 20],
  [18, 1, 1, 1, 1, 1, 0, 0, 0, 0, 3, 0.1, 72],

  // ── Pasta & Rice (catIdx=19) ──
  [19, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.2, 60],
  [19, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 78],
  [19, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.3, 50],
  [19, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0.2, 68],
  [19, 3, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.6, 32],
  [19, 1, 1, 1, 1, 1, 0, 0, 1, 0, 3, 0.1, 85],
  [19, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0.4, 48],
  [19, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0.2, 62],
  [19, 4, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0.8, 22],
  [19, 1, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0.1, 75],
];

// ─── Parse raw data into structured examples ─────────────────────
export function getTrainingExamples(): TrainingExample[] {
  return RAW_TRAINING_DATA.map(row => ({
    categoryIndex: row[0],
    novaGroup: row[1],
    hasOrganic: row[2],
    hasFairtrade: row[3],
    hasEcoCert: row[4],
    packagingRecyclable: row[5],
    packagingGlass: row[6],
    packagingPlastic: row[7],
    originLocal: row[8],
    originImportedFar: row[9],
    numCertifications: row[10],
    processingLevel: row[11],
    targetScore: row[12],
  }));
}

// ─── Data augmentation for training (adds noise for generalization) ──
export function augmentTrainingData(
  examples: TrainingExample[],
  augmentFactor: number = 5
): TrainingExample[] {
  const augmented: TrainingExample[] = [...examples];

  for (let i = 0; i < augmentFactor; i++) {
    for (const ex of examples) {
      const noiseScale = 0.05; // ±5% noise on score
      const scoreNoise = (Math.random() * 2 - 1) * noiseScale * ex.targetScore;
      const processingNoise = (Math.random() * 2 - 1) * 0.1;

      augmented.push({
        ...ex,
        processingLevel: Math.max(0, Math.min(1, ex.processingLevel + processingNoise)),
        targetScore: Math.max(0, Math.min(100, Math.round(ex.targetScore + scoreNoise))),
      });
    }
  }

  return augmented;
}

// ─── Convert examples to feature/target arrays ──────────────────
export function examplesToArrays(examples: TrainingExample[]): {
  features: number[][];
  targets: number[];
} {
  const features: number[][] = [];
  const targets: number[] = [];

  for (const ex of examples) {
    features.push([
      ex.categoryIndex / (NUM_CATEGORIES - 1), // Normalize to 0-1
      ex.novaGroup / 4,                        // Normalize to 0-1
      ex.hasOrganic,
      ex.hasFairtrade,
      ex.hasEcoCert,
      ex.packagingRecyclable,
      ex.packagingGlass,
      ex.packagingPlastic,
      ex.originLocal,
      ex.originImportedFar,
      Math.min(ex.numCertifications, 5) / 5,   // Normalize to 0-1
      ex.processingLevel,
    ]);
    targets.push(ex.targetScore / 100); // Normalize to 0-1 for sigmoid
  }

  return { features, targets };
}

// ─── Shuffle data for training ───────────────────────────────────
export function shuffleData(features: number[][], targets: number[]): {
  features: number[][];
  targets: number[];
} {
  const indices = Array.from({ length: features.length }, (_, i) => i);
  for (let i = indices.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }

  return {
    features: indices.map(i => features[i]),
    targets: indices.map(i => targets[i]),
  };
}
